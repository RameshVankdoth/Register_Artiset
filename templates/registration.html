<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Registration</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <style>
        body {
            font-family: Arial, sans-serif;
            color: #333;
        }

        .header {
            background-color: #343a40;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .header img {
            max-height: 80px;
        }

        .form-container {
            margin-top: 20px;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .footer {
            background-color: #343a40;
            color: #fff;
            padding: 20px;
            text-align: center;
        }

        .footer .gradient-text {
            background: linear-gradient(45deg, #f06, #4a90e2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-label {
            font-weight: 500;
            color: #495057;
        }

        .btn-primary {
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .form-control {
            border: 1px solid #ced4da;
            border-radius: 5px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-control:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(38, 143, 255, 0.25);
        }

        .form-control-file {
            border-radius: 5px;
            padding: 10px;
        }

        .pass-check, .text-danger {
            font-size: 0.875rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>

    <header class="header">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <a class="scroll logo" href="#wrapper">
                        <img class="logo-default" src="{{ url_for('static', filename='img/logo.png') }}" alt="logo" />
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="container form-container">
        {% with messages = get_flashed_messages(with_categories=True) %}
            {% if messages %}
                <div class="alert alert-dismissible fade show" role="alert">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endif %}
        {% endwith %}
        <form id="registrationForm" enctype="multipart/form-data" method="POST">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="Fullname" class="form-label">Full Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="Fullname" name="Fullname" placeholder="Enter your full name" required />
                </div>
                <div class="col-md-6 mb-3">
                    <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email" required />
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="mobile" class="form-label">Mobile <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="mobile" name="mobile" pattern="\d{10}" maxlength="10" placeholder="Enter 10-digit mobile number" required />
                </div>

                <div class="col-md-4 mb-3">
                    <label for="gender" class="form-label">Gender <span class="text-danger">*</span></label>
                    <select class="form-control" id="gender" name="gender" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="col-md-4 mb-3">
                    <label for="dob" class="form-label">DOB <span class="text-danger">*</span></label>
                    <input type="date" class="form-control" id="dob" name="dob" required />
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="level" class="form-label">Education Level <span class="text-danger">*</span></label>
                    <select class="form-control" id="level" name="level" required><!-- matching "level" or it should be "education level" -->
                        <option value="">Select Education Level</option>
                        {% for level in levels %}
                        <option value="{{ level.LevelName }}">{{ level.LevelName }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="college" class="form-label">College <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="college" name="college" required />
                </div>
                <div class="col-md-4 mb-3">
                    <label for="marks" class="form-label">Avg Marks (CGPA) <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="marks" name="marks" required />
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="Course" class="form-label">Course <span class="text-danger">*</span></label>
                    <select class="form-control" id="Course" name="Course" required>
                        <option value="">Select Course</option>
                        {% for course in courses %}
                        <option value="{{ course.CourseName }}">{{ course.CourseName }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="Specialization" class="form-label">Specialization <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="Specialization" name="Specialization" required />
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="positionApplying" class="form-label">Position Applying<span class="text-danger">*</span></label>
                    <select class="form-control" id="positionApplying" name="positionApplying" required>
                        <option value="">Select Position</option>
                        {% for pos in positions %}
                        <option value="{{ pos.name }}">{{ pos.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="primarySkill" class="form-label">Primary Skill <span class="text-danger">*</span></label>
                    <select class="form-control" id="primarySkill" name="primarySkill" required>
                        <option value="">Select Skill</option>
                        {% for skill in skills %}
                        <option value="{{ skill }}">{{ skill }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="secondarySkill" class="form-label">Secondary Skill <span class="text-danger">*</span></label>
                    <select class="form-control" id="secondarySkill" name="secondarySkill" required>
                        <option value="">Select Skill</option>
                        {% for skill in skills %}
                        <option value="{{ skill }}">{{ skill }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="altphone" class="form-label">Altername Phone: <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="altphone" name="altphone" placeholder="Enter Alternate Phone" required />
                </div>
                <div class="col-md-6 mb-3">
                    <label for="altemail" class="form-label">Alternate Email <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="altemail" name="altemail" placeholder="Enter Alternate Email" required />
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <div class="form-group">
                        <label for="homeState">Home State <span class="text-danger">*</span></label>
                        <select class="form-control" id="homeState" name="homeState" required>
                            <option value="">Select State</option>
                            {% for state in states %}
                            <option value="{{ state.id }}">{{ state.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="form-group">
                        <label for="homeCity">Home City <span class="text-danger">*</span></label>
                        <select class="form-control" id="homeCity" name="homeCity" required>
                            <option value="">Select City</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <div class="form-group">
                        <label for="currState">Current State <span class="text-danger">*</span></label>
                        <select class="form-control" id="currState" name="currState" required>
                            <option value="">Select State</option>
                            {% for state in states %}
                            <option value="{{ state.id }}">{{ state.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="form-group">
                        <label for="currCity">Current City <span class="text-danger">*</span></label>
                        <select class="form-control" id="currCity" name="currCity" required>
                            <option value="">Select City</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <div class="form-group">
                        <label for="prefCity"> Preferred location <span class="text-danger">*</span></label>
                        <select class="form-control" id="prefCity" name="prefCity" required>
                            <option value="">Select City</option>
                            {% set specific_cities = ['Pune', 'Mumbai', 'Bengaluru'] %}
                            {% for city in cities if city.name in specific_cities %}
                            <option value="{{ city.name }}">{{ city.name }}</option>
                            {% endfor %}
                        </select>
                        
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="resume" class="form-label">Resume <span class="text-danger">*</span></label>
                    <input type="file" class="form-control-file" id="resume" name="resume" accept=".pdf,.doc,.docx" required />
                </div>
            </div>

            <div class="form-group">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="terms" required />
                    <label class="form-check-label" for="terms">
                        I accept the <a href="#">terms and conditions</a>.
                    </label>
                </div>
            </div>

            <div class="form-group">
                <button type="submit" class="btn btn-primary" onclick="showConfirmation()">Register</button>
            </div>
        </form>
    </div>

    <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Confirm Your Details</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p><strong>Full Name:</strong> <span id="confirmFullname"></span></p>
                    <p><strong>Email:</strong> <span id="confirmEmail"></span></p>
                    <p><strong>Mobile:</strong> <span id="confirmMobile"></span></p>
                    <p><strong>Gender:</strong> <span id="confirmGender"></span></p>
                    <p><strong>Date of Birth:</strong> <span id="confirmDob"></span></p>
                    <p><strong>Education Level:</strong> <span id="confirmLevel"></span></p>
                    <p><strong>College:</strong> <span id="confirmCollege"></span></p>
                    <p><strong>Average Marks:</strong> <span id="confirmMarks"></span></p>
                    <p><strong>Course:</strong> <span id="confirmCourse"></span></p>
                    <p><strong>Specialization:</strong> <span id="confirmSpecialization"></span></p>
                    <p><strong>Primary Skill:</strong> <span id="confirmPrimarySkill"></span></p>
                    <p><strong>Secondary Skill:</strong> <span id="confirmSecondarySkill"></span></p>
                    <p><strong>Position Applying:</strong> <span id="confirmPositionApplying"></span></p>
                    <p><strong>Home State:</strong> <span id="confirmHomeState"></span></p>
                    <p><strong>Home City:</strong> <span id="confirmHomeCity"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="closeForm()">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitForm()">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p class="gradient-text">Artiset Talent Hunt &copy; 2024</p>
    </footer>

    <!-- jQuery, Popper.js, and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Custom JS -->
    <script>
        // Convert Jinja2 cities array to JavaScript array
        var cities = {{ cities|tojson|safe }};
        var states = {{ states|tojson|safe }};

        function updateCityDropdown(stateSelectId, citySelectId) {
            var stateId = document.getElementById(stateSelectId).value;
            var citySelect = document.getElementById(citySelectId);
            
            // Clear previous options
            citySelect.innerHTML = '<option value="">Select City</option>';

            // Filter and add new options
            cities.forEach(function(city) {
                if (city.state_id == stateId) {
                    var option = document.createElement('option');
                    option.value = city.id;
                    option.textContent = city.name;
                    citySelect.appendChild(option);
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            var stateSelect = document.getElementById('homeState');
            stateSelect.addEventListener('change', function() {
                updateCityDropdown('homeState', 'homeCity');
            });

            // Trigger the update function on page load if a state is pre-selected
            updateCityDropdown('homeState', 'homeCity');
        });

        document.addEventListener('DOMContentLoaded', function() {
            var stateSelect = document.getElementById('currState');
            stateSelect.addEventListener('change', function() {
                updateCityDropdown('currState',  'currCity');
            });

            // Trigger the update function on page load if a state is pre-selected
            updateCityDropdown('currState', 'currCity');
        });

    </script>
    <script>
        function updateCityDropdown(stateSelectId, citySelectId) {
            const stateSelect = document.getElementById(stateSelectId);
            const citySelect = document.getElementById(citySelectId);
            const stateId = stateSelect.value;

            // Clear existing options
            citySelect.innerHTML = '<option value="">Select City</option>';

            if (!stateId) {
                return;
            }

            // Fetch cities based on selected state
            fetch(`/get_cities?state_id=${stateId}`)
                .then(response => response.json())
                .then(data => {
                    data.cities.forEach(city => {
                        const option = document.createElement('option');
                        option.value = city.id;
                        option.text = city.name;
                        citySelect.add(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching cities:', error);
                });
        }

        function showConfirmation() {
            const form = document.getElementById('registrationForm');
            document.getElementById('confirmFullname').textContent = form.Fullname.value;
            document.getElementById('confirmEmail').textContent = form.email.value;
            // Set more fields as needed
            $('#confirmationModal').modal('show');
        }

        function submitForm() {
            const form = document.getElementById('registrationForm');
            form.submit();
        }
    </script>
    <script>
       function showConfirmation(event) {
    event.preventDefault(); // Prevent form submission

    // Get form values
    const fullname = $('#Fullname').val();
    const email = $('#email').val();
    const mobile = $('#mobile').val();
    const gender = $('#gender').val();
    const dob = $('#dob').val();
    const level = $('#level').val();
    const college = $('#college').val();
    const marks = $('#marks').val();
    const course = $('#Course').val();
    const specialization = $('#Specialization').val();
    const primarySkill = $('#primarySkill').val();
    const secondarySkill = $('#secondarySkill').val();
    const positionApplying = $('#positionApplying').val();
    const homeState = $('#homeState').val();
    const homeCity = $('#homeCity').val();

    // Set values in modal
    $('#confirmFullname').text(fullname);
    $('#confirmEmail').text(email);
    $('#confirmMobile').text(mobile);
    $('#confirmGender').text(gender);
    $('#confirmDob').text(dob);
    $('#confirmLevel').text(level);
    $('#confirmCollege').text(college);
    $('#confirmMarks').text(marks);
    $('#confirmCourse').text(course);
    $('#confirmSpecialization').text(specialization);
    $('#confirmPrimarySkill').text(primarySkill);
    $('#confirmSecondarySkill').text(secondarySkill);
    $('#confirmPositionApplying').text(positionApplying);
    $('#confirmHomeState').text(homeState);
    $('#confirmHomeCity').text(homeCity);

    // Show modal
    $('#confirmationModal').modal('show');
}

function closeForm() {
    $('#confirmationModal').modal('hide');
}

// Function to submit form after confirmation
function submitForm() {
    // Hide the modal
    $('#confirmationModal').modal('hide');

//     // Submit the form via AJAX
//     const formData = new FormData(document.getElementById('registrationForm'));
//     fetch('/register', {
//         method: 'POST',
//         body: formData
//     }).then(response => {
//         if (response.redirected) {
//             window.location.href = response.url;
//         }
//     }).catch(error => {
//         console.error('Error:', error);
//     });
}

    </script>

</body>

</html>
